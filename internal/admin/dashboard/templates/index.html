{{define "index"}}
<!-- Overview Page -->
<div x-show="page==='overview'">
    <div class="page-header">
        <h2>Usage Overview</h2>
        <div class="page-header-controls">
            <div class="interval-picker">
                <button class="interval-btn" :class="{active: interval==='daily'}" @click="setInterval('daily')">Daily</button>
                <button class="interval-btn" :class="{active: interval==='weekly'}" @click="setInterval('weekly')">Weekly</button>
                <button class="interval-btn" :class="{active: interval==='monthly'}" @click="setInterval('monthly')">Monthly</button>
                <button class="interval-btn" :class="{active: interval==='yearly'}" @click="setInterval('yearly')">Yearly</button>
            </div>
            <div class="date-picker" @click.outside="closeDatePicker()" @keydown.escape.window="closeDatePicker()">
            <button class="date-picker-trigger" @click="toggleDatePicker()">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M5 1v2M11 1v2M2 6h12M3 3h10a1 1 0 011 1v9a1 1 0 01-1 1H3a1 1 0 01-1-1V4a1 1 0 011-1z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <span x-text="dateRangeLabel()">Last 30 days</span>
                <svg class="date-picker-chevron" :class="{ open: datePickerOpen }" width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M3 4.5l3 3 3-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <div class="date-picker-dropdown" x-show="datePickerOpen" x-transition.opacity.duration.150ms>
                <div class="date-picker-presets">
                    <button class="preset-btn" :class="{ active: selectedPreset === '3' }" @click="selectPreset('3')">Last 3 days</button>
                    <button class="preset-btn" :class="{ active: selectedPreset === '7' }" @click="selectPreset('7')">Last 7 days</button>
                    <button class="preset-btn" :class="{ active: selectedPreset === '14' }" @click="selectPreset('14')">Last 14 days</button>
                    <button class="preset-btn" :class="{ active: selectedPreset === '30' }" @click="selectPreset('30')">Last 30 days</button>
                    <button class="preset-btn" :class="{ active: selectedPreset === '90' }" @click="selectPreset('90')">Last 90 days</button>
                </div>
                <div class="date-picker-calendars" @mousemove="onCalendarMouseMove($event)" @mouseleave="onCalendarMouseLeave()">
                    <!-- Left calendar (previous month) -->
                    <div class="dp-calendar">
                        <div class="dp-cal-header">
                            <button class="dp-nav-btn" @click="prevMonth()">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M8.5 3.5L5 7l3.5 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                            <span class="dp-cal-title" x-text="calendarTitle(-1)"></span>
                            <span></span>
                        </div>
                        <div class="dp-weekdays">
                            <span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span><span>Su</span>
                        </div>
                        <div class="dp-days">
                            <template x-for="day in calendarDays(-1)" :key="day.key">
                                <button class="dp-day"
                                    :class="{
                                        'other-month': !day.current,
                                        'today': isToday(day),
                                        'range-start': isRangeStart(day),
                                        'range-end': isRangeEnd(day),
                                        'in-range': isInRange(day),
                                        'disabled': isFutureDay(day)
                                    }"
                                    :disabled="isFutureDay(day) || !day.current"
                                    @click="selectCalendarDay(day)"
                                    x-text="day.day">
                                </button>
                            </template>
                        </div>
                    </div>
                    <!-- Right calendar (current month) -->
                    <div class="dp-calendar">
                        <div class="dp-cal-header">
                            <button class="dp-nav-btn dp-nav-prev-mobile" @click="prevMonth()">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M8.5 3.5L5 7l3.5 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                            <span class="dp-cal-title" x-text="calendarTitle(0)"></span>
                            <button class="dp-nav-btn" @click="nextMonth()" :disabled="isCurrentMonth()">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M5.5 3.5L9 7l-3.5 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            </button>
                        </div>
                        <div class="dp-weekdays">
                            <span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span><span>Su</span>
                        </div>
                        <div class="dp-days">
                            <template x-for="day in calendarDays(0)" :key="day.key">
                                <button class="dp-day"
                                    :class="{
                                        'other-month': !day.current,
                                        'today': isToday(day),
                                        'range-start': isRangeStart(day),
                                        'range-end': isRangeEnd(day),
                                        'in-range': isInRange(day),
                                        'disabled': isFutureDay(day)
                                    }"
                                    :disabled="isFutureDay(day) || !day.current"
                                    @click="selectCalendarDay(day)"
                                    x-text="day.day">
                                </button>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dp-cursor-hint" x-show="cursorHint.show" :style="'left:'+cursorHint.x+'px;top:'+cursorHint.y+'px'">
                <template x-if="selectingDate==='start'">
                    <svg viewBox="0 0 12 12" fill="none"><path d="M2 2v8M2 6h7M6.5 3.5L9 6 6.5 8.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </template>
                <template x-if="selectingDate==='end'">
                    <svg viewBox="0 0 12 12" fill="none"><path d="M10 2v8M3 6h7M5.5 3.5L3 6l2.5 2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </template>
                <span x-text="selectionHint()"></span>
            </div>
        </div>
        </div>
    </div>

    <!-- Auth Error Banner -->
    <div class="alert alert-warning" x-show="authError">
        Authentication required. Enter your API key in the sidebar to view data.
    </div>

    <!-- Summary Cards -->
    <div class="cards">
        <div class="card">
            <div class="card-label">Total Requests</div>
            <div class="card-value" x-text="formatNumber(summary.total_requests)">-</div>
        </div>
        <div class="card">
            <div class="card-label">Input Tokens</div>
            <div class="card-value" x-text="formatNumber(summary.total_input_tokens)">-</div>
        </div>
        <div class="card">
            <div class="card-label">Output Tokens</div>
            <div class="card-value" x-text="formatNumber(summary.total_output_tokens)">-</div>
        </div>
        <div class="card">
            <div class="card-label">Total Tokens</div>
            <div class="card-value" x-text="formatNumber(summary.total_tokens)">-</div>
        </div>
        <div class="card">
            <div class="card-label">Estimated Cost</div>
            <div class="card-value" x-text="formatCost(summary.total_cost)">-</div>
        </div>
    </div>

    <!-- Usage Chart -->
    <div class="chart-container">
        <h3 x-text="chartTitle()">Daily Token Usage</h3>
        <div class="chart-wrapper">
            <canvas id="usageChart"></canvas>
        </div>
        <p class="empty-state" x-show="daily.length === 0 && !loading && !authError">No usage data yet.</p>
    </div>
</div>

<!-- Models Page -->
<div x-show="page==='models'">
    <div class="page-header">
        <h2>Registered Models</h2>
        <div class="model-count" x-show="models.length > 0">
            <span x-text="modelFilter ? filteredModels.length + ' / ' + models.length : models.length"></span> models
        </div>
    </div>

    <!-- Auth Error Banner -->
    <div class="alert alert-warning" x-show="authError">
        Authentication required. Enter your API key in the sidebar to view data.
    </div>

    <!-- Category Tabs -->
    <div class="category-tabs" x-show="categories.length > 0">
        <template x-for="cat in categories" :key="cat.category">
            <button class="category-tab" :class="{ active: activeCategory === cat.category }" @click="selectCategory(cat.category)">
                <span x-text="cat.display_name"></span>
                <span class="tab-count" x-text="cat.count"></span>
            </button>
        </template>
    </div>

    <!-- Filter -->
    <div class="table-toolbar" x-show="models.length > 0 || modelFilter">
        <input type="text" placeholder="Filter by model, provider, or owner..." x-model="modelFilter" class="filter-input">
    </div>

    <!-- Models Table: All / Text Generation -->
    <div class="table-wrapper" x-show="(models.length > 0 || modelFilter) && (activeCategory === 'all' || activeCategory === 'text_generation')">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Model ID</th>
                    <th>Provider</th>
                    <th>Mode</th>
                    <th class="col-price">Input $/MTok</th>
                    <th class="col-price">Output $/MTok</th>
                    <th class="col-price" x-show="activeCategory === 'text_generation'">Cached $/MTok</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="m in filteredModels" :key="m.model.id">
                    <tr>
                        <td class="mono" x-text="m.model.id"></td>
                        <td><span class="provider-badge" x-text="m.provider_type"></span></td>
                        <td x-text="m.model.metadata?.mode || '-'"></td>
                        <td class="col-price" x-text="formatPrice(m.model.metadata?.pricing?.input_per_mtok)"></td>
                        <td class="col-price" x-text="formatPrice(m.model.metadata?.pricing?.output_per_mtok)"></td>
                        <td class="col-price" x-show="activeCategory === 'text_generation'" x-text="formatPrice(m.model.metadata?.pricing?.cached_input_per_mtok)"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>

    <!-- Models Table: Embeddings -->
    <div class="table-wrapper" x-show="(models.length > 0 || modelFilter) && activeCategory === 'embedding'">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Model ID</th>
                    <th>Provider</th>
                    <th class="col-price">Input $/MTok</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="m in filteredModels" :key="m.model.id">
                    <tr>
                        <td class="mono" x-text="m.model.id"></td>
                        <td><span class="provider-badge" x-text="m.provider_type"></span></td>
                        <td class="col-price" x-text="formatPrice(m.model.metadata?.pricing?.input_per_mtok)"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>

    <!-- Models Table: Image -->
    <div class="table-wrapper" x-show="(models.length > 0 || modelFilter) && activeCategory === 'image'">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Model ID</th>
                    <th>Provider</th>
                    <th class="col-price">$/Image</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="m in filteredModels" :key="m.model.id">
                    <tr>
                        <td class="mono" x-text="m.model.id"></td>
                        <td><span class="provider-badge" x-text="m.provider_type"></span></td>
                        <td class="col-price" x-text="formatPriceFine(m.model.metadata?.pricing?.per_image)"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>

    <!-- Models Table: Audio -->
    <div class="table-wrapper" x-show="(models.length > 0 || modelFilter) && activeCategory === 'audio'">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Model ID</th>
                    <th>Provider</th>
                    <th class="col-price">$/Second</th>
                    <th class="col-price">$/Character</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="m in filteredModels" :key="m.model.id">
                    <tr>
                        <td class="mono" x-text="m.model.id"></td>
                        <td><span class="provider-badge" x-text="m.provider_type"></span></td>
                        <td class="col-price" x-text="formatPriceFine(m.model.metadata?.pricing?.per_second_input)"></td>
                        <td class="col-price" x-text="formatPriceFine(m.model.metadata?.pricing?.per_character_input)"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>

    <!-- Models Table: Video -->
    <div class="table-wrapper" x-show="(models.length > 0 || modelFilter) && activeCategory === 'video'">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Model ID</th>
                    <th>Provider</th>
                    <th class="col-price">$/Second (In)</th>
                    <th class="col-price">$/Second (Out)</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="m in filteredModels" :key="m.model.id">
                    <tr>
                        <td class="mono" x-text="m.model.id"></td>
                        <td><span class="provider-badge" x-text="m.provider_type"></span></td>
                        <td class="col-price" x-text="formatPriceFine(m.model.metadata?.pricing?.per_second_input)"></td>
                        <td class="col-price" x-text="formatPriceFine(m.model.metadata?.pricing?.per_second_output)"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>

    <!-- Models Table: Utility -->
    <div class="table-wrapper" x-show="(models.length > 0 || modelFilter) && activeCategory === 'utility'">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Model ID</th>
                    <th>Provider</th>
                    <th class="col-price">$/Page</th>
                    <th class="col-price">$/Request</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="m in filteredModels" :key="m.model.id">
                    <tr>
                        <td class="mono" x-text="m.model.id"></td>
                        <td><span class="provider-badge" x-text="m.provider_type"></span></td>
                        <td class="col-price" x-text="formatPriceFine(m.model.metadata?.pricing?.per_page)"></td>
                        <td class="col-price" x-text="formatPriceFine(m.model.metadata?.pricing?.per_request)"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>

    <p class="empty-state" x-show="models.length === 0 && !loading && !authError && !modelFilter">No models registered.</p>
    <p class="empty-state" x-show="models.length > 0 && filteredModels.length === 0 && modelFilter">No models match your filter.</p>
</div>
{{end}}
